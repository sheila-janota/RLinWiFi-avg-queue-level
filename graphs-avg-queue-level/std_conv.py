import matplotlib.pyplot as plt
from bs4 import BeautifulSoup
import numpy as np
import pandas as pd
from scipy.signal import medfilt

def svg_to_data_conv(svg, a, b, thresh=0):
    bs = BeautifulSoup(f)
    num = -1
    for en, i in enumerate(bs.find_all("path")):
        if "js-line" in i["class"]:
            num = en

    vals = bs.find_all("path")[num]["d"].split("L")[1:]
    data = []
    unique = []
    xs = []
    for val in vals:
        x = float(val.split(",")[0])/100
        y_val = float(val.split(",")[1])
        if x>thresh:
            if y_val not in unique:
                unique.append(y_val)
            xs.append(x)
            data.append(a*y_val + b)
            
    print(np.max(unique), np.min(unique))
    return xs, data

def generate_station_data(samples, count):
    repeats = len(samples)//count
    arr = np.arange(count).repeat(repeats)
    x = np.arange(len(samples), dtype=np.float32)/len(samples)
    x *= np.max(samples)
    remains = len(samples)-len(arr)

    for i in range(remains):
        index = np.random.randint(len(arr))
        arr = np.insert(arr, index, arr[index])
    
    return x, arr

# with open("Chosen CW.svg") as f:
#     a = -1.191
#     b = 539.949
#     x_data, data = svg_to_data_conv(f, a, b)

with open("fig3/CT_beb.svg") as f:
    a = -0.04685579196217462
    b = 47.5011111111111
    x_beb, beb = svg_to_data_conv(f, a, b)

with open("fig3/CT_ddpg.svg") as f:
    a = -0.02075289575289574
    b = 44.26583011583012
    x_ddpg, ddpg = svg_to_data_conv(f, a, b)

with open("fig3/CT_dqn.svg") as f:
    a = -0.03226629256472377
    b = 45.80444841219228
    x_dqn, dqn = svg_to_data_conv(f, a, b)

# with open("Station count.svg") as f:
#     a = -0.1073345259391771
#     b = 52.92486583184257
#     x_stations, stations = svg_to_data_conv(f, a, b, thresh=-0.1)
#     stations = np.interp(x_data, x_stations, stations)

# x_station, stations = generate_station_data(x_dqn, 50)

# fig, ax1 = plt.subplots()
# plt.xlabel("Simulation time [s]")

# color = 'tab:blue'
# ax1.set_ylabel('CW', color=color)
# ax1.plot(x_data, data)
# ax1.tick_params(axis='y', labelcolor=color)

# ax2 = ax1.twinx()
# color = 'tab:red'
# ax2.set_ylabel('Transmitting stations', color=color)
# ax2.plot(x_station, stations, color=color)
# ax2.tick_params(axis='y', labelcolor=color)

# plt.xticks(np.arange(7)*7/6, np.arange(7)*10)
# plt.show()

#dqn_y = [23.455801010131836,30.25799560546875,31.732358932495117,31.397275924682617,30.9840030670166,31.542482376098633,32.145633697509766,32.212650299072266,31.97808837890625,32.212650299072266,31.3861083984375,32.670589447021484,32.514217376708984,31.66534423828125,32.123291015625,31.6318359375,33.34075927734375,34.982669830322266,30.8052978515625,31.307920455932617,33.865718841552734,30.101625442504883,32.33551025390625,32.279659271240234,31.520143508911133,33.173213958740234,32.033935546875,32.480709075927734,32.849308013916016,31.955751419067383,34.636417388916016,30.99517822265625,29.587827682495117,28.817140579223633,29.74420928955078,31.84405517578125,31.497802734375,33.43010711669922,32.7041015625,33.351932525634766,34.077938079833984,29.721864700317383,32.022762298583984,32.503047943115234,33.463623046875,33.564151763916016,33.798709869384766,34.72576141357422,31.93341064453125,32.391361236572266,32.659427642822266,32.692935943603516,33.284912109375,32.97216033935547,37.305904388427734,37.138362884521484,32.35784912109375,32.08978271484375,31.2520751953125,31.19622802734375,32.223812103271484,37.0601806640625,38.38934326171875,38.25531005859375,38.255313873291016,37.83087158203125,32.469539642333984,31.374937057495117,33.162044525146484,33.441287994384766,33.619998931884766,33.7093505859375,32.011600494384766,40.489200592041016,30.313840866088867,30.62657928466797,36.7921028137207,33.262569427490234,35.596981048583984,35.742183685302734,35.8985595703125,35.853885650634766,34.971492767333984,35.596981048583984,35.518795013427734,34.457698822021484,33.776363372802734,32.134456634521484,46.755245208740234,33.575313568115234,34.044429779052734,34.111446380615234,33.865718841552734,32.960994720458984,33.06151580810547,33.43010330200195,34.513545989990234,33.575313568115234,34.267822265625,45.33672332763672,34.993831634521484,36.524044036865234,36.93731689453125,36.53521728515625,36.24481201171875,36.066097259521484,36.412349700927734,36.479366302490234,36.78094482421875,35.35125732421875,36.80328369140625,35.976741790771484,36.032588958740234,36.010250091552734,35.418277740478516,35.552310943603516,35.909725189208984,36.2113037109375,36.490543365478516,36.646907806396484,36.557559967041016,36.6357421875,36.35650634765625,35.920894622802734,37.004329681396484,36.87030029296875,36.211307525634766,36.144290924072266,36.31182861328125,35.7198486328125,35.731014251708984,35.50762939453125,33.27374267578125,34.156124114990234,33.86572265625,39.037174224853516,33.843379974365234,33.57530975341797,34.748104095458984,34.16729736328125,33.508304595947266,37.97610092163086,37.07135009765625,36.914981842041016,36.635738372802734,37.082515716552734,36.66925048828125,37.060176849365234,36.144283294677734,37.127193450927734,36.970821380615234,37.87554931640625,37.00433349609375,37.54046630859375,37.361759185791016,37.395263671875,37.339412689208984,37.205379486083984,37.3729248046875,36.948490142822266,37.384090423583984,36.758602142333984,36.73626708984375,36.669246673583984,36.970821380615234,36.49053955078125,34.893306732177734,34.558223724365234,37.596317291259766,37.629817962646484,37.17186737060547,37.171871185302734,37.607479095458984,37.618656158447266,37.3505859375,37.495784759521484,37.6856689453125,37.540462493896484,36.95965576171875,37.261234283447266,37.361751556396484,36.903804779052734,36.367671966552734,37.216548919677734,37.305904388427734,37.596309661865234,37.7080078125,37.127193450927734,36.6134033203125,36.937320709228516,37.16070556640625,37.093692779541016,37.853206634521484,37.94256591796875,37.830875396728516,37.127193450927734,37.305904388427734,36.82562255859375,36.914981842041016,37.13836669921875,36.87030029296875,36.825618743896484,36.345333099365234,37.238887786865234,37.294734954833984,37.171871185302734,36.993160247802734,36.22246551513672,37.238887786865234,37.160701751708984,37.40518569946289,37.685665130615234,37.540470123291016,37.551639556884766,37.31707763671875,37.07135009765625,37.16069793701172,37.250057220458984,37.149532318115234,37.573970794677734,38.0877685546875,36.713924407958984,36.926143646240234,37.082515716552734,37.79736328125,37.685665130615234,37.305904388427734,36.62457275390625,36.7027587890625,36.981990814208984,37.250057220458984,37.4176025390625,37.730342864990234,37.931400299072266,37.205387115478516,37.305908203125,37.305904388427734,37.116024017333984,36.725093841552734,37.417606353759766,37.16070556640625,37.018699645996094,37.5963134765625,37.696834564208984,37.942569732666016,37.842044830322266,37.69683837890625,37.607479095458984,37.573970794677734,37.797359466552734,37.439945220947266,37.607479095458984,34.770450592041016,34.636417388916016,34.803951263427734,47.52592849731445,48.698726654052734,50.0167236328125,37.250057220458984,37.551639556884766,37.83087158203125,37.227718353271484,37.07134246826172,36.501712799072266,37.14952850341797,37.585140228271484,37.417606353759766,37.62981414794922,37.305904388427734,37.87554931640625,37.9984130859375,36.40118408203125,36.1219482421875,36.557552337646484,36.412349700927734,37.987239837646484,37.987247467041016,36.948482513427734,37.76385498046875,37.96490478515625,37.305912017822266,38.367008209228516,38.16595458984375,37.272403717041016,37.47344970703125,37.04901123046875,36.937320709228516,36.881465911865234,36.981990814208984,37.5069580078125,37.506954193115234,37.439937591552734,37.305908203125,37.5516357421875,37.708003997802734,37.495784759521484,37.47344970703125,37.529293060302734,37.283573150634766,37.51812744140625,37.596309661865234,37.640987396240234,37.428775787353516,37.5069580078125,36.635738372802734,35.731014251708984,36.468196868896484,36.434688568115234,36.434688568115234,36.602230072021484,35.775691986083984,35.831539154052734,36.457027435302734,36.233638763427734,36.188961029052734,37.87895202636719,38.087772369384766,37.830875396728516,37.964908599853516,36.981990814208984,37.0601806640625,37.45111083984375,37.775020599365234,37.987239837646484,37.909053802490234,37.65216064453125,37.439937591552734,37.518123626708984,37.853206634521484,37.763851165771484,38.255306243896484,37.909053802490234,37.708003997802734,37.763851165771484,37.864376068115234,37.65216064453125,38.00958251953125,37.674495697021484,37.51812744140625,37.372928619384766,38.043094635009766,36.870296478271484,36.859130859375,48.08440399169922,37.506961822509766,37.484619140625,37.071346282958984,38.41168212890625,37.88671875,38.6239013671875,37.98723602294922,38.03191375732422,37.830867767333984,37.763858795166016,37.495784759521484,38.445186614990234,38.367000579833984,37.85321044921875,37.685665130615234,37.674495697021484,37.339412689208984,37.562801361083984,37.540462493896484,38.065425872802734,37.909053802490234,38.299983978271484,38.266475677490234,37.797367095947266,37.87554931640625,37.082515716552734,37.116024017333984,37.741512298583984,37.66332244873047,37.171875,37.00433349609375,38.244144439697266,38.14361572265625,37.618648529052734,37.562801361083984,38.221797943115234,37.80853271484375,37.74151611328125,37.752685546875,37.775020599365234,37.395263671875,37.060176849365234,37.786197662353516,37.87554931640625,37.573970794677734,37.618648529052734,37.42877197265625,37.328243255615234,37.484615325927734,37.77501678466797,37.830867767333984,37.942569732666016,37.060176849365234,36.836788177490234,37.294734954833984,37.372920989990234,37.283565521240234,37.43994140625,37.29067611694336,38.03192138671875,38.0430908203125,37.663330078125,37.607479095458984,37.663333892822266,37.372920989990234,37.317073822021484,37.842041015625,38.400508880615234,38.16595458984375,38.076602935791016,37.6409912109375,37.49578857421875,37.518123626708984,37.708003997802734,37.864376068115234,37.261226654052734,37.250057220458984,37.719173431396484,37.7750244140625,37.8197021484375,37.60748291015625,38.00958251953125,37.98724365234375,38.065433502197266,37.875553131103516,37.607486724853516,37.629817962646484,37.953731536865234,37.060184478759766,37.573978424072266,37.696834564208984,38.00958251953125,37.763851165771484,37.529296875,37.562801361083984,37.27239990234375,37.763851165771484,37.16070556640625,37.250064849853516,37.1942138671875,37.171878814697266,37.853206634521484,37.752685546875,37.62982177734375,37.417598724365234,37.886722564697266,38.299991607666016,38.299991607666016,38.0430908203125,37.238887786865234,37.216548919677734,37.216548919677734,37.484615325927734,38.165950775146484,37.920223236083984,37.719173431396484,37.864383697509766,37.842041015625,37.596309661865234,37.395259857177734,37.629817962646484,37.38408660888672,37.629817962646484,37.116024017333984,37.305912017822266,37.317073822021484,37.328243255615234,38.50103759765625,38.668575286865234,38.32232666015625,37.886714935302734,37.7526741027832,38.21063232421875,38.411678314208984,37.730342864990234,37.40643310546875,37.596309661865234,37.730342864990234,37.920230865478516,37.696834564208984,38.333492279052734,38.143611907958984,38.21063232421875,37.67449951171875,37.674495697021484,37.596309661865234,37.7750244140625,37.652156829833984,37.451107025146484,37.78619384765625,37.54046630859375,37.294734954833984,37.573970794677734,37.629817962646484,37.160701751708984,37.26123046875,36.80328369140625]

#ddpg_y = [40.209999084472656,29.989927291870117,30.28034019470215,30.25800132751465,28.3256893157959,33.955081939697266,34.625244140625,31.7435302734375,31.721189498901367,41.393917083740234,30.570741653442383,28.6607723236084,28.75012969970703,30.403196334838867,31.185056686401367,30.604248046875,30.7606258392334,28.98468780517578,31.15155601501465,31.10687255859375,34.468875885009766,30.45905113220215,30.447877883911133,29.822385787963867,31.151548385620117,32.134464263916016,31.497804641723633,31.363771438598633,31.162721633911133,28.64959716796875,32.413700103759766,27.46563720703125,28.459716796875,25.667360305786133,25.488645553588867,33.106197357177734,33.13970947265625,10.052499771118164,32.413692474365234,33.173213958740234,30.861143112182617,28.9735164642334,28.582582473754883,38.54571533203125,38.288822174072266,32.536556243896484,31.26324462890625,32.022762298583984,33.072689056396484,32.16796875,31.799375534057617,32.357852935791016,31.609495162963867,31.810544967651367,31.743532180786133,32.570068359375,32.771114349365234,33.0391845703125,32.84930419921875,32.335514068603516,32.413700103759766,33.798702239990234,32.916324615478516,31.944581985473633,31.95574951171875,32.69293212890625,30.9840087890625,30.481386184692383,30.269163131713867,32.3690185546875,32.938663482666016,31.832883834838867,43.63896942138672,31.777036666870117,30.9393253326416,31.497804641723633,47.637638092041016,32.469539642333984,34.357177734375,34.6475830078125,32.78228759765625,30.637758255004883,30.570741653442383,36.948482513427734,33.217899322509766,32.704105377197266,33.798702239990234,32.972164154052734,33.821041107177734,32.5030517578125,28.716611862182617,30.77179718017578,31.12921714782715,33.083858489990234,37.51812744140625,36.624576568603516,33.22907257080078,33.351932525634766,34.56939697265625,34.859806060791016,31.9222412109375,32.581241607666016,35.1837158203125,34.859806060791016,35.5634765625,35.23956298828125,34.93798065185547,33.3965950012207,32.212642669677734,32.089778900146484,32.324337005615234,33.061527252197266,30.34735679626465,35.753360748291016,35.630496978759766,30.481386184692383,29.67718505859375,33.98858642578125,45.78350067138672,46.018062591552734,35.060848236083984,50.02788543701172,32.49188232421875,34.77043914794922,35.29540252685547,34.256656646728516,34.602909088134766,34.669921875,35.01617431640625,35.0496826171875,46.911617279052734,35.328914642333984,35.284236907958984,35.328914642333984,35.831539154052734,35.95441436767578,36.02142333984375,35.161373138427734,35.295406341552734,35.5411376953125,37.13836669921875,36.267154693603516,36.546390533447266,36.434696197509766,36.73626708984375,35.8092041015625,33.83221435546875,33.731689453125,34.211978912353516,32.614749908447266,31.598325729370117,31.44196128845215,31.33026695251465,36.077266693115234,35.987911224365234,35.86504364013672,35.016170501708984,34.993831634521484,35.261898040771484,35.2730712890625,35.552303314208984,34.792781829833984,34.79278564453125,35.55230712890625,35.987911224365234,35.753353118896484,36.702754974365234,36.077266693115234,36.931968688964844,37.16938781738281,37.060176849365234,36.780941009521484,37.13835906982422,37.037837982177734,37.07135009765625,36.847957611083984,36.870296478271484,37.25006103515625,37.071353912353516,37.3505859375,37.171875,37.618648529052734,36.981990814208984,36.959651947021484,36.568721771240234,37.22772216796875,37.384090423583984,37.551631927490234,36.970829010009766,36.993160247802734,37.607486724853516,37.629825592041016,37.238887786865234,37.194210052490234,35.932071685791016,36.691593170166016,37.361751556396484,36.859127044677734,36.624568939208984,36.747432708740234,36.345333099365234,37.183040618896484,37.194210052490234,37.227718353271484,37.049007415771484,36.847957611083984,36.557552337646484,36.356510162353516,36.624568939208984,37.049007415771484,36.99315643310547,36.501705169677734,36.859127044677734,38.01903533935547,37.808536529541016,37.797367095947266,38.16595458984375,37.69683837890625,37.719173431396484,37.897884368896484,37.685665130615234,37.663333892822266,37.417598724365234,37.56280517578125,37.31707763671875,37.33941650390625,37.395259857177734,37.54046630859375,37.830867767333984,37.83087158203125,37.76385498046875,37.842041015625,37.183040618896484,37.160701751708984,37.093685150146484,36.4793701171875,36.501705169677734,36.680416107177734,36.133113861083984,36.032588958740234,36.42352294921875,36.591068267822266,36.780948638916016,36.8814697265625,36.479366302490234,37.060176849365234,38.456363677978516,38.5345458984375,37.853206634521484,37.987239837646484,38.020748138427734,38.523372650146484,37.708003997802734,37.56280517578125,37.763851165771484,37.808528900146484,37.775028228759766,37.305908203125,37.29473876953125,37.67449951171875,37.33941650390625,37.417598724365234,37.439937591552734,37.305904388427734,37.473445892333984,37.56280517578125,37.049015045166016,37.45111083984375,37.227718353271484,37.428768157958984,37.462284088134766,36.289485931396484,35.9879035949707,36.12194061279297,35.898555755615234,36.54638671875,36.289485931396484,38.45635986328125,37.987247467041016,38.255306243896484,38.143611907958984,38.3558349609375,37.685665130615234,38.020755767822266,37.640995025634766,37.71916961669922,37.51812744140625,37.596309661865234,37.573970794677734,37.3729248046875,37.183040618896484,37.752681732177734,37.372920989990234,37.328243255615234,37.183040618896484,37.451114654541016,37.194210052490234,37.037837982177734,37.797359466552734,37.94256591796875,37.830875396728516,37.417606353759766,37.00433349609375,37.462276458740234,37.607479095458984,37.395259857177734,37.60747528076172,37.76385498046875,37.00433349609375,37.250057220458984,37.328243255615234,37.317073822021484,37.395259857177734,37.529296875,37.62982177734375,37.652164459228516,37.573970794677734,38.0430908203125,39.0070915222168,39.077919006347656,38.009586334228516,38.009586334228516,38.478702545166016,38.333492279052734,38.512210845947266,38.45635986328125,38.177120208740234,38.154781341552734,38.400516510009766,37.51812744140625,37.685665130615234,37.797359466552734,38.14361572265625,37.953731536865234,37.808536529541016,37.60748291015625,38.0430908203125,37.696842193603516,38.29998779296875,37.3505859375,37.663330078125,37.76385498046875,37.49578857421875,37.708003997802734,37.9537353515625,36.89263916015625,37.026668548583984,37.61864471435547,38.09893798828125,37.629817962646484,37.864376068115234,37.29473876953125,37.40643310546875,38.74729537963867,38.489871978759766,38.15478515625,38.512210845947266,38.512210845947266,37.998409271240234,37.629817962646484,37.62982177734375,37.652164459228516,37.629817962646484,37.585140228271484,37.875553131103516,37.953739166259766,37.79736328125,37.585147857666016,37.384090423583984,37.864376068115234,37.54046630859375,37.484619140625,37.775020599365234,37.71918487548828,37.573970794677734,37.652156829833984,37.931396484375,38.999935150146484,38.199462890625,38.389347076416016,37.518131256103516,38.311153411865234,38.043087005615234,37.976070404052734,38.076595306396484,37.55164337158203,38.009578704833984,38.020748138427734,37.987247467041016,37.495784759521484,37.640987396240234,38.07659149169922,37.596309661865234,37.42877197265625,37.506961822509766,37.439945220947266,37.573970794677734,37.51811981201172,37.65214920043945,37.819698333740234,37.741512298583984,37.540462493896484,37.607479095458984,37.842041015625,38.34466552734375,38.52337646484375,38.992488861083984,37.830867767333984,38.389347076416016,37.864376068115234,37.529293060302734,38.031925201416016,38.41168212890625,37.752685546875,37.62982177734375,37.998409271240234,38.177120208740234,38.087764739990234,37.830867767333984,37.819698333740234,37.752689361572266,37.98724365234375,38.076595306396484,37.819705963134766,37.886714935302734,37.708003997802734,37.395263671875,37.808528900146484,37.842037200927734,38.132442474365234,38.199462890625,37.685672760009766,37.7303466796875,37.350582122802734,37.384090423583984,38.110103607177734,37.819698333740234,37.652156829833984,37.875545501708984,37.775020599365234,37.640987396240234,37.92022705078125,37.484615325927734,37.663326263427734,37.808528900146484,37.987247467041016,37.89788818359375,38.132442474365234,38.288814544677734,38.031917572021484,38.623905181884766,37.361759185791016,37.573978424072266,38.355838775634766,37.909053802490234,38.0877685546875,37.94256591796875,37.897884368896484,37.920223236083984,38.21063232421875,37.85321044921875,37.953739166259766,38.132442474365234,38.020748138427734,37.797367095947266,37.79736328125,37.931400299072266,37.551631927490234,37.484619140625,37.439937591552734,38.210628509521484,38.199459075927734,37.91790008544922,38.411678314208984,38.031925201416016,37.83087158203125,37.730342864990234,37.62982177734375,37.529293060302734,37.9984130859375,37.79735565185547,37.830867767333984,37.819698333740234,37.9090576171875,37.58514404296875,37.529296875,37.7080078125,37.864383697509766,37.830867767333984,37.886714935302734,38.0430908203125,37.931396484375,37.719173431396484,37.909061431884766,38.031917572021484,37.964900970458984,37.931400299072266,37.909061431884766,37.897891998291016,37.830875396728516,37.88671875,37.819698333740234]

#idxStart2 = 344 # 260
#idxEnd2 = 800 #800

#dqn_Th = dqn_y[idxStart2:idxEnd2]
#ddpg_Th = ddpg_y[idxStart2:idxEnd2]

df = pd.read_csv('ddpgThAvgQ.csv')
filter_length = 9
ddpg_Th_medfilt = medfilt(df['throughput'],filter_length)

##### BEB vs DQN throughput
plt.plot(x_beb, beb, label="Beb")
plt.plot(x_ddpg, ddpg, label="DQN")
plt.plot(x_dqn, dqn, label="DDPG")
#plt.plot(dqn_Th, label="DQN-repro")
#plt.plot(ddpg_Th, label="DDPG-repro")
plt.plot(ddpg_Th_medfilt)
plt.ylabel("Throughput [Mb/s]")
plt.xlabel("Simulation time [s]")
plt.xticks(np.arange(7)*7/6, np.arange(7)*10)
plt.xlim([0, 7])
plt.show()

# fig, ax1 = plt.subplots()
# plt.xlabel("Simulation time [s]")

# color = 'tab:blue'
# ax1.set_ylabel('Throughput [MB/s]', color=color)
# ax1.plot(x_beb, beb)
# ax1.plot(x_dqn, dqn)
# ax1.tick_params(axis='y', labelcolor=color)

# ax2 = ax1.twinx()
# color = 'tab:red'
# ax2.set_ylabel('Transmitting stations', color=color)
# ax2.plot(x_station, stations, color=color)
# ax2.tick_params(axis='y', labelcolor=color)

# plt.xticks(np.arange(7)*7/6, np.arange(7)*10)
# plt.show()

